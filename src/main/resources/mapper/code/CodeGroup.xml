<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.default1.module.code.mapper.CodeGroupMapper">
    <sql id="selectCodeGroupQuery">
        SELECT
            `id`
            , `code_group`
            , `name`
            , `create_time`
            , `create_id`
            , `update_time`
            , `update_id`
        FROM `code_group`
    </sql>

    <sql id="searchCodeGroupCondition">
        <where>
            <if test="codeGroup != null and codeGroup != ''">
                AND code_group LIKE concat('%', #{codeGroup}, '%')
            </if>
            <if test="name != null and name != ''">
                AND `name` LIKE concat('%', #{name}, '%')
            </if>
        </where>
    </sql>

    <select id="countAllBy" resultType="java.lang.Long">
        SELECT COUNT(1)
        FROM `code_group`
        <include refid="searchCodeGroupCondition"/>
    </select>

    <select id="findAllBy" resultType="com.example.default1.module.code.model.CodeGroupSearchParam">
        <include refid="selectCodeGroupQuery" />
        <include refid="searchCodeGroupCondition"/>
        ORDER BY id DESC
    </select>

    <select id="findById" resultType="com.example.default1.module.code.model.CodeGroupSearchParam">
        <include refid="selectCodeGroupQuery" />
        WHERE id = #{id}
    </select>

    <insert id="create">
        INSERT INTO code_group (
            `code_group`
            , `name`
            , `create_id`
            , `update_id`
        ) VALUES (
            (SELECT code_group FROM (SELECT COALESCE(max(code_group) + 1, 100) code_group FROM code_group)
             as code_group)
            , #{name}
            , #{createId}
            , #{updateId}
        )
    </insert>

    <update id="update">
        UPDATE code_group
        <set>
            <if test="name != null and name != ''">
                name = #{name},
            </if>
            update_time = NOW()
        </set>
        WHERE id = #{id}
    </update>

    <delete id="removeById">
        DELETE FROM code_group
        WHERE id = #{id}
    </delete>
</mapper>